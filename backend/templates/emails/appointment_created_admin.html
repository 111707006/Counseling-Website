{% extends "emails/base_email.html" %}

{% block title %}新預約通知 - 心理諮商預約系統{% endblock %}

{% block header_title %}📅 新預約通知{% endblock %}
{% block header_subtitle %}<p style="margin: 10px 0 0 0; font-size: 16px; opacity: 0.9;">有新的預約申請需要您的處理</p>{% endblock %}

{% block greeting %}
<p>親愛的管理員，您好：</p>
{% endblock %}

{% block content %}
<div class="alert info">
    <strong>🔔 系統通知</strong><br>
    有一位用戶剛剛提交了新的心理諮商預約申請，請盡快處理。
</div>

<p>預約詳細資訊如下：</p>
{% endblock %}

{% block appointment_details %}
<div class="appointment-card">
    <h3 style="margin-top: 0; color: #667eea;">預約資訊</h3>
    
    <div class="appointment-detail">
        <span class="detail-label">預約編號：</span>
        <span class="detail-value"><strong>#{{ appointment.id }}</strong></span>
    </div>
    
    <div class="appointment-detail">
        <span class="detail-label">申請人姓名：</span>
        <span class="detail-value">{{ appointment.detail.name }}</span>
    </div>
    
    <div class="appointment-detail">
        <span class="detail-label">聯絡電話：</span>
        <span class="detail-value">{{ appointment.detail.phone }}</span>
    </div>
    
    <div class="appointment-detail">
        <span class="detail-label">電子郵件：</span>
        <span class="detail-value">{{ appointment.user.email }}</span>
    </div>
    
    <div class="appointment-detail">
        <span class="detail-label">指定心理師：</span>
        <span class="detail-value">{{ appointment.therapist.name }}</span>
    </div>
    
    <div class="appointment-detail">
        <span class="detail-label">申請時間：</span>
        <span class="detail-value">{{ appointment.created_at|date:"Y年m月d日 H:i" }}</span>
    </div>
    
    <div class="appointment-detail">
        <span class="detail-label">目前狀態：</span>
        <span class="detail-value">
            <span style="background-color: #fef3cd; color: #856404; padding: 4px 8px; border-radius: 4px; font-size: 12px;">
                待確認
            </span>
        </span>
    </div>
</div>

<div class="appointment-card">
    <h3 style="margin-top: 0; color: #667eea;">偏好時段</h3>
    {% for period in appointment.preferred_periods.all %}
    <div class="appointment-detail">
        <span class="detail-label">時段 {{ forloop.counter }}：</span>
        <span class="detail-value">
            {{ period.date|date:"Y年m月d日" }} 
            {% if period.period == 'morning' %}上午 (09:00-12:00)
            {% elif period.period == 'afternoon' %}下午 (13:00-17:00)
            {% elif period.period == 'evening' %}晚上 (18:00-21:00)
            {% endif %}
        </span>
    </div>
    {% endfor %}
</div>

{% if appointment.detail.main_concerns %}
<div class="appointment-card">
    <h3 style="margin-top: 0; color: #667eea;">主要困擾</h3>
    <p style="margin: 0; padding: 10px; background-color: white; border-radius: 4px; border: 1px solid #e2e8f0;">
        {{ appointment.detail.main_concerns }}
    </p>
</div>
{% endif %}

{% if appointment.detail.previous_therapy %}
<div class="appointment-card">
    <h3 style="margin-top: 0; color: #667eea;">過往諮商經驗</h3>
    <p style="margin: 0; padding: 10px; background-color: white; border-radius: 4px; border: 1px solid #e2e8f0;">
        {{ appointment.detail.previous_therapy }}
    </p>
</div>
{% endif %}

{% if appointment.detail.urgency %}
<div class="appointment-card">
    <h3 style="margin-top: 0; color: #667eea;">緊急程度</h3>
    <div class="appointment-detail">
        <span class="detail-value">
            {% if appointment.detail.urgency == 'low' %}🟢 低 - 可等待適當時機安排
            {% elif appointment.detail.urgency == 'medium' %}🟡 中 - 希望儘快安排
            {% elif appointment.detail.urgency == 'high' %}🔴 高 - 需要緊急處理
            {% endif %}
        </span>
    </div>
</div>
{% endif %}

{% if appointment.detail.special_needs %}
<div class="appointment-card">
    <h3 style="margin-top: 0; color: #667eea;">特殊需求</h3>
    <p style="margin: 0; padding: 10px; background-color: white; border-radius: 4px; border: 1px solid #e2e8f0;">
        {{ appointment.detail.special_needs }}
    </p>
</div>
{% endif %}
{% endblock %}

{% block actions %}
<div style="text-align: center; margin: 30px 0;">
    <p><strong>請盡快處理此預約申請</strong></p>
    <a href="{{ admin_url }}" class="button">前往管理後台處理</a>
</div>
{% endblock %}

{% block additional_info %}
<div class="divider"></div>
<div class="alert warning">
    <strong>⏰ 處理提醒</strong><br>
    請在 24 小時內回覆預約申請，以維持良好的服務品質。如需更改心理師安排或時段，請直接在管理後台操作。
</div>
{% endblock %}