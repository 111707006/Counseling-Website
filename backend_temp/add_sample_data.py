#!/usr/bin/env python
import os
import sys
import django
from datetime import datetime, timedelta
from django.utils import timezone

# è¨­ç½® Django ç’°å¢ƒ
sys.path.append(os.path.dirname(os.path.abspath(__file__)))
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'mindcare.settings')
django.setup()

from announcements.models import AnnouncementCategory, Announcement
from users.models import User

def create_sample_data():
    print("é–‹å§‹å‰µå»ºå‡è³‡æ–™...")
    
    # å‰µå»ºç®¡ç†å“¡ç”¨æˆ¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
    admin_user, created = User.objects.get_or_create(
        email='admin@mindcare.com',
        defaults={
            'username': 'admin',
            'is_staff': True,
            'is_superuser': True,
        }
    )
    if created:
        admin_user.set_password('admin123')
        admin_user.save()
        print("ç®¡ç†å“¡ç”¨æˆ¶å·²å‰µå»º")
    else:
        print("ç®¡ç†å“¡ç”¨æˆ¶å·²å­˜åœ¨")

    # å‰µå»ºå…¬å‘Šåˆ†é¡
    categories_data = [
        {
            'name': 'é‡è¦é€šçŸ¥',
            'description': 'é‡è¦çš„æ©Ÿæ§‹é€šçŸ¥äº‹é …',
            'color': '#000000',
            'order': 1
        },
        {
            'name': 'æ´»å‹•æ¶ˆæ¯',
            'description': 'å„ç¨®æ´»å‹•å’Œè¬›åº§æ¶ˆæ¯',
            'color': '#666666',
            'order': 2
        },
        {
            'name': 'æœå‹™å…¬å‘Š',
            'description': 'æœå‹™ç›¸é—œçš„å…¬å‘Š',
            'color': '#333333',
            'order': 3
        }
    ]
    
    created_categories = []
    for cat_data in categories_data:
        category, created = AnnouncementCategory.objects.get_or_create(
            name=cat_data['name'],
            defaults=cat_data
        )
        created_categories.append(category)
        if created:
            print(f"å‰µå»ºåˆ†é¡ï¼š{category.name}")
        else:
            print(f"åˆ†é¡å·²å­˜åœ¨ï¼š{category.name}")

    # å‰µå»ºå…¬å‘Š
    announcements_data = [
        {
            'title': 'æ–°å¹´åº¦å¿ƒç†è«®å•†é ç´„é–‹å§‹å—ç†',
            'summary': '2025å¹´åº¦çš„å¿ƒç†è«®å•†é ç´„æ­£å¼é–‹æ”¾ï¼Œæ­¡è¿æœ‰éœ€è¦çš„æ°‘çœ¾ä¾†é›»é ç´„ã€‚æˆ‘å€‘æä¾›å°ˆæ¥­çš„å¿ƒç†è«®å•†æœå‹™ï¼Œå”åŠ©æ‚¨é¢å°ç”Ÿæ´»ä¸­çš„å„ç¨®æŒ‘æˆ°ã€‚',
            'content': '''
            <h2>æ–°å¹´åº¦å¿ƒç†è«®å•†é ç´„æ­£å¼é–‹æ”¾</h2>
            
            <p>è¦ªæ„›çš„æœ‹å‹å€‘ï¼š</p>
            
            <p>å¼µè€å¸«å°åŒ—å¿ƒç†è«®å•†æ‰€å¾ˆé«˜èˆˆå®£å¸ƒï¼Œ2025å¹´åº¦çš„å¿ƒç†è«®å•†é ç´„æœå‹™æ­£å¼é–‹æ”¾å—ç†ï¼</p>
            
            <h3>æœå‹™å…§å®¹åŒ…æ‹¬ï¼š</h3>
            <ul>
                <li>å€‹åˆ¥å¿ƒç†è«®å•†</li>
                <li>ä¼´ä¾¶è«®å•†</li>
                <li>å®¶åº­æ²»ç™‚</li>
                <li>é’å°‘å¹´è«®å•†</li>
                <li>å‰µå‚·æ²»ç™‚</li>
            </ul>
            
            <h3>é ç´„æ–¹å¼ï¼š</h3>
            <p>ğŸ“ é›»è©±é ç´„ï¼š(02) 2532-6180</p>
            <p>ğŸ’» ç·šä¸Šé ç´„ï¼šé€éæœ¬ç¶²ç«™é ç´„ç³»çµ±</p>
            <p>ğŸ• æœå‹™æ™‚é–“ï¼šé€±ä¸€è‡³é€±å…­ 09:00-21:30ï¼Œé€±æ—¥ 09:00-17:00</p>
            
            <p>æˆ‘å€‘çš„å°ˆæ¥­å¿ƒç†å¸«åœ˜éšŠå°‡æä¾›æ‚¨æœ€é©åˆ‡çš„å”åŠ©ï¼Œé™ªä¼´æ‚¨èµ°éç”Ÿå‘½ä¸­çš„æ¯å€‹éšæ®µã€‚</p>
            ''',
            'category': created_categories[0],  # é‡è¦é€šçŸ¥
            'priority': 'high',
            'is_pinned': True,
            'show_on_homepage': True,
            'author': admin_user,
            'views_count': 156,
            'likes_count': 23
        },
        {
            'title': 'å¿ƒç†å¥åº·è¬›åº§ã€Œæƒ…ç·’ç®¡ç†èˆ‡è‡ªæˆ‘ç…§é¡§ã€å³æ—¥èµ·å ±å',
            'summary': 'æœ¬è¬›åº§å°‡æ·±å…¥æ¢è¨æƒ…ç·’ç®¡ç†çš„æŠ€å·§èˆ‡è‡ªæˆ‘ç…§é¡§çš„é‡è¦æ€§ï¼Œç”±è³‡æ·±å¿ƒç†å¸«ä¸»è¬›ï¼Œæ­¡è¿æ°‘çœ¾è¸´èºå ±ååƒåŠ ã€‚',
            'content': '''
            <h2>å¿ƒç†å¥åº·è¬›åº§ï¼šæƒ…ç·’ç®¡ç†èˆ‡è‡ªæˆ‘ç…§é¡§</h2>
            
            <p>åœ¨å¿«ç¯€å¥çš„ç¾ä»£ç”Ÿæ´»ä¸­ï¼Œå­¸æœƒç®¡ç†æƒ…ç·’å’Œç…§é¡§è‡ªå·±æ˜¯éå¸¸é‡è¦çš„ç”Ÿæ´»æŠ€èƒ½ã€‚</p>
            
            <h3>è¬›åº§è³‡è¨Šï¼š</h3>
            <ul>
                <li><strong>ä¸»é¡Œï¼š</strong>æƒ…ç·’ç®¡ç†èˆ‡è‡ªæˆ‘ç…§é¡§</li>
                <li><strong>è¬›å¸«ï¼š</strong>è³‡æ·±å¿ƒç†å¸« æå¿ƒç†å¸«</li>
                <li><strong>æ™‚é–“ï¼š</strong>2025å¹´2æœˆ15æ—¥ï¼ˆå…­ï¼‰14:00-16:00</li>
                <li><strong>åœ°é»ï¼š</strong>å¼µè€å¸«å°åŒ—å¿ƒç†è«®å•†æ‰€</li>
                <li><strong>è²»ç”¨ï¼š</strong>å…è²»åƒåŠ </li>
            </ul>
            
            <h3>è¬›åº§å…§å®¹ï¼š</h3>
            <p>â€¢ èªè­˜æƒ…ç·’çš„æœ¬è³ªèˆ‡åŠŸèƒ½</p>
            <p>â€¢ å­¸ç¿’æƒ…ç·’èª¿ç¯€çš„å¯¦ç”¨æŠ€å·§</p>
            <p>â€¢ å»ºç«‹å¥åº·çš„è‡ªæˆ‘ç…§é¡§ç¿’æ…£</p>
            <p>â€¢ å£“åŠ›ç®¡ç†èˆ‡æ”¾é¬†æŠ€å·§</p>
            
            <p><strong>å ±åæ–¹å¼ï¼š</strong>è«‹ä¾†é›» (02) 2532-6180 æˆ–é€éç¶²ç«™å ±å</p>
            <p>åé¡æœ‰é™ï¼Œæ•¬è«‹æŠŠæ¡æ©Ÿæœƒï¼</p>
            ''',
            'category': created_categories[1],  # æ´»å‹•æ¶ˆæ¯
            'priority': 'medium',
            'is_pinned': False,
            'show_on_homepage': True,
            'author': admin_user,
            'views_count': 89,
            'likes_count': 15
        },
        {
            'title': 'ç·šä¸Šè«®å•†æœå‹™æŒçºŒæä¾›ï¼Œæ–¹ä¾¿æ‚¨çš„æ™‚é–“å®‰æ’',
            'summary': 'è€ƒé‡åˆ°ç¾ä»£äººçš„å¿™ç¢Œç”Ÿæ´»ï¼Œæˆ‘å€‘æŒçºŒæä¾›ç·šä¸Šå¿ƒç†è«®å•†æœå‹™ï¼Œè®“æ‚¨å¯ä»¥åœ¨èˆ’é©çš„ç’°å¢ƒä¸­æ¥å—å°ˆæ¥­å”åŠ©ã€‚',
            'content': '''
            <h2>ç·šä¸Šå¿ƒç†è«®å•†æœå‹™</h2>
            
            <p>ç‚ºäº†è®“æ›´å¤šéœ€è¦å¹«åŠ©çš„æœ‹å‹èƒ½å¤ ä¾¿åˆ©åœ°æ¥å—å¿ƒç†è«®å•†æœå‹™ï¼Œå¼µè€å¸«å°åŒ—å¿ƒç†è«®å•†æ‰€æŒçºŒæä¾›ç·šä¸Šè«®å•†æœå‹™ã€‚</p>
            
            <h3>ç·šä¸Šè«®å•†çš„å„ªé»ï¼š</h3>
            <ul>
                <li>ç¯€çœé€šå‹¤æ™‚é–“</li>
                <li>åœ¨ç†Ÿæ‚‰ç’°å¢ƒä¸­é€²è¡Œè«®å•†</li>
                <li>é©åˆè¡Œå‹•ä¸ä¾¿è€…</li>
                <li>ä¿æœ‰å®Œå…¨çš„éš±ç§æ€§</li>
                <li>å½ˆæ€§çš„æ™‚é–“å®‰æ’</li>
            </ul>
            
            <h3>æŠ€è¡“è¦æ±‚ï¼š</h3>
            <p>â€¢ ç©©å®šçš„ç¶²è·¯é€£ç·š</p>
            <p>â€¢ é›»è…¦ã€å¹³æ¿æˆ–æ™ºæ…§å‹æ‰‹æ©Ÿ</p>
            <p>â€¢ å®‰éœä¸”ç§å¯†çš„ç©ºé–“</p>
            <p>â€¢ è¦–è¨Šè»Ÿé«”ï¼ˆæˆ‘å€‘å°‡å”åŠ©å®‰è£ï¼‰</p>
            
            <h3>å¦‚ä½•é–‹å§‹ï¼š</h3>
            <ol>
                <li>ä¾†é›»é ç´„è«®å•†æ™‚é–“</li>
                <li>å‘ŠçŸ¥éœ€è¦ç·šä¸Šè«®å•†æœå‹™</li>
                <li>æˆ‘å€‘å°‡å”åŠ©æ‚¨è¨­å®šæŠ€è¡“ç’°å¢ƒ</li>
                <li>åœ¨é ç´„æ™‚é–“é–‹å§‹è«®å•†</li>
            </ol>
            
            <p>ç·šä¸Šè«®å•†èˆ‡é¢å°é¢è«®å•†å…·æœ‰ç›¸åŒçš„å°ˆæ¥­å“è³ªï¼Œæ­¡è¿æ‚¨å¤šåŠ åˆ©ç”¨ï¼</p>
            ''',
            'category': created_categories[2],  # æœå‹™å…¬å‘Š
            'priority': 'low',
            'is_pinned': False,
            'show_on_homepage': True,
            'author': admin_user,
            'views_count': 67,
            'likes_count': 8
        },
        {
            'title': 'æ˜¥ç¯€æœŸé–“æœå‹™æ™‚é–“èª¿æ•´é€šçŸ¥',
            'summary': '2025å¹´è¾²æ›†æ˜¥ç¯€æœŸé–“ï¼Œæœ¬æ‰€æœå‹™æ™‚é–“å°‡æœ‰æ‰€èª¿æ•´ï¼Œè«‹æ°‘çœ¾ç•™æ„ç›¸é—œç•°å‹•è¨Šæ¯ã€‚',
            'content': '''
            <h2>æ˜¥ç¯€æœŸé–“æœå‹™æ™‚é–“èª¿æ•´</h2>
            
            <p>è¦ªæ„›çš„æœå‹™ä½¿ç”¨è€…ï¼Œ</p>
            
            <p>é…åˆ2025å¹´è¾²æ›†æ˜¥ç¯€å‡æœŸï¼Œå¼µè€å¸«å°åŒ—å¿ƒç†è«®å•†æ‰€æœå‹™æ™‚é–“èª¿æ•´å¦‚ä¸‹ï¼š</p>
            
            <h3>ä¼‘å‡æœŸé–“ï¼š</h3>
            <ul>
                <li>1æœˆ28æ—¥ï¼ˆäºŒï¼‰é™¤å¤•ï¼šä¼‘è¨º</li>
                <li>1æœˆ29æ—¥ï¼ˆä¸‰ï¼‰åˆä¸€ï¼šä¼‘è¨º</li>
                <li>1æœˆ30æ—¥ï¼ˆå››ï¼‰åˆäºŒï¼šä¼‘è¨º</li>
                <li>1æœˆ31æ—¥ï¼ˆäº”ï¼‰åˆä¸‰ï¼šä¼‘è¨º</li>
            </ul>
            
            <h3>æ­£å¸¸æœå‹™ï¼š</h3>
            <p>2æœˆ1æ—¥ï¼ˆå…­ï¼‰åˆå››èµ·æ¢å¾©æ­£å¸¸æœå‹™æ™‚é–“</p>
            
            <h3>ç·Šæ€¥è¯çµ¡ï¼š</h3>
            <p>æ˜¥ç¯€æœŸé–“å¦‚æœ‰ç·Šæ€¥å¿ƒç†å±æ©Ÿéœ€æ±‚ï¼Œè«‹è¯çµ¡ï¼š</p>
            <p>â€¢ ç”Ÿå‘½ç·šï¼š1995</p>
            <p>â€¢ å¼µè€å¸«å°ˆç·šï¼š1980</p>
            <p>â€¢ ç·Šæ€¥å°ˆç·šï¼š(02) 2532-6180 è½‰åˆ†æ©Ÿ999</p>
            
            <p>ç¥æ‚¨æ–°æ˜¥æ„‰å¿«ï¼Œèº«å¿ƒå¥åº·ï¼</p>
            ''',
            'category': created_categories[0],  # é‡è¦é€šçŸ¥
            'priority': 'medium',
            'is_pinned': False,
            'show_on_homepage': False,
            'author': admin_user,
            'views_count': 124,
            'likes_count': 12
        },
        {
            'title': 'åœ˜é«”æ²»ç™‚èª²ç¨‹ã€Œäººéš›é—œä¿‚æˆé•·åœ˜é«”ã€é–‹å§‹æ‹›ç”Ÿ',
            'summary': 'é€éåœ˜é«”äº’å‹•çš„æ–¹å¼ï¼Œå­¸ç¿’å»ºç«‹å¥åº·çš„äººéš›é—œä¿‚ï¼Œæå‡æºé€šæŠ€å·§èˆ‡æƒ…æ„Ÿè¡¨é”èƒ½åŠ›ã€‚',
            'content': '''
            <h2>äººéš›é—œä¿‚æˆé•·åœ˜é«”</h2>
            
            <p>äººéš›é—œä¿‚æ˜¯å½±éŸ¿å¿ƒç†å¥åº·çš„é‡è¦å› ç´ ã€‚é€éåœ˜é«”æ²»ç™‚çš„æ–¹å¼ï¼Œæˆ‘å€‘å¯ä»¥åœ¨å®‰å…¨çš„ç’°å¢ƒä¸­ç·´ç¿’èˆ‡ä»–äººäº’å‹•ï¼Œå­¸ç¿’æ›´å¥½çš„æºé€šæ–¹å¼ã€‚</p>
            
            <h3>èª²ç¨‹ç‰¹è‰²ï¼š</h3>
            <ul>
                <li>å°ç­åˆ¶æ•™å­¸ï¼ˆ6-8äººï¼‰</li>
                <li>å°ˆæ¥­å¿ƒç†å¸«å¸¶é ˜</li>
                <li>çµæ§‹åŒ–çš„å­¸ç¿’å…§å®¹</li>
                <li>å¯¦éš›æ¼”ç·´èˆ‡å›é¥‹</li>
            </ul>
            
            <h3>é©åˆå°è±¡ï¼š</h3>
            <p>â€¢ æƒ³è¦æ”¹å–„äººéš›é—œä¿‚çš„æœ‹å‹</p>
            <p>â€¢ åœ¨è·å ´æºé€šä¸Šé‡åˆ°å›°é›£è€…</p>
            <p>â€¢ å¸Œæœ›æå‡è‡ªä¿¡å¿ƒçš„æ°‘çœ¾</p>
            <p>â€¢ æƒ³è¦å­¸ç¿’è¡¨é”æƒ…æ„Ÿçš„äºº</p>
            
            <h3>èª²ç¨‹è³‡è¨Šï¼š</h3>
            <ul>
                <li><strong>æ™‚é–“ï¼š</strong>æ¯é€±å›› 19:00-21:00</li>
                <li><strong>æœŸé–“ï¼š</strong>é€£çºŒ8é€±</li>
                <li><strong>é–‹èª²æ—¥ï¼š</strong>2025å¹´2æœˆ20æ—¥</li>
                <li><strong>è²»ç”¨ï¼š</strong>æ¯äºº4800å…ƒ</li>
            </ul>
            
            <p>å ±åè«‹æ´½ï¼š(02) 2532-6180</p>
            ''',
            'category': created_categories[1],  # æ´»å‹•æ¶ˆæ¯
            'priority': 'medium',
            'is_pinned': False,
            'show_on_homepage': False,
            'author': admin_user,
            'views_count': 45,
            'likes_count': 7
        }
    ]

    # è¨­ç½®ç™¼å¸ƒæ™‚é–“
    base_time = timezone.now()
    
    for i, ann_data in enumerate(announcements_data):
        # è¨­ç½®ä¸åŒçš„ç™¼å¸ƒæ™‚é–“
        publish_time = base_time - timedelta(days=i*2, hours=i*3)
        
        announcement, created = Announcement.objects.get_or_create(
            title=ann_data['title'],
            defaults={
                **ann_data,
                'status': 'published',
                'publish_date': publish_time,
                'created_at': publish_time,
                'updated_at': publish_time,
            }
        )
        
        if created:
            print(f"å‰µå»ºå…¬å‘Šï¼š{announcement.title}")
        else:
            print(f"å…¬å‘Šå·²å­˜åœ¨ï¼š{announcement.title}")

    print("\nå‡è³‡æ–™å‰µå»ºå®Œæˆï¼")
    print(f"å‰µå»ºäº† {len(categories_data)} å€‹åˆ†é¡")
    print(f"å‰µå»ºäº† {len(announcements_data)} å€‹å…¬å‘Š")

if __name__ == '__main__':
    create_sample_data()